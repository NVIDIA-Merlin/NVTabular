<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Accelerated Training with HugeCTR &mdash; NVTabular 2021 documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/togglebutton.css" type="text/css" />
      <link rel="stylesheet" href="../_static/mystnb.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script >let toggleHintShow = 'Click to show';</script>
        <script >let toggleHintHide = 'Click to hide';</script>
        <script >let toggleOpenOnPrint = 'true';</script>
        <script src="../_static/togglebutton.js"></script>
        <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="NVTabular Example Notebooks" href="../examples/index.html" />
    <link rel="prev" title="Accelerated Training with PyTorch" href="pytorch.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> NVTabular
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../core_features.html">Core Features</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Accelerated Training</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="tensorflow.html">TensorFlow</a></li>
<li class="toctree-l2"><a class="reference internal" href="pytorch.html">PyTorch</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">HugeCTR</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Example Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../resources/index.html">Additional Resources</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NVTabular</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Accelerated Training</a> &raquo;</li>
      <li>Accelerated Training with HugeCTR</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="accelerated-training-with-hugectr">
<h1>Accelerated Training with HugeCTR<a class="headerlink" href="#accelerated-training-with-hugectr" title="Permalink to this headline"></a></h1>
<p>A real-world production model serves hundreds of millions of users,
which contains embedding tables with up to 100GB to 1TB in size. Training deep
learning recommender system models with such large embedding tables can be challenging
as they do not fit into the memory of a single GPU.</p>
<p>To combat that challenge, we’ve developed HugeCTR, which is an open-source deep learning framework that is a highly optimized library
written in CUDA C++, specifically for recommender systems. It supports
an optimized dataloader and is able to scale embedding tables using
multiple GPUs and nodes. As a result, there’s no embedding table size
limitation. HugeCTR also offers the following:</p>
<ul class="simple">
<li><p>Model oversubscription for training embedding tables with
single nodes that don’t fit within the GPU or CPU memory (only
required embeddings are prefetched from a parameter server per
batch).</p></li>
<li><p>Asynchronous and multithreaded data pipelines.</p></li>
<li><p>A highly optimized data loader.</p></li>
<li><p>Implementation of common architectures such as Wide&amp;Deep and DLRM.</p></li>
<li><p>Support for data formats such as parquet and binary.</p></li>
<li><p>Easy configuration using JSON or the Python API.</p></li>
</ul>
<p>When training is accelerated with HugeCTR, the following happens:</p>
<ol class="arabic">
<li><p>The required libraries are imported in which the HugeCTR lib
directory is specified as follows:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sys</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;/usr/local/hugectr/lib&quot;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">hugectr</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">solver_parser_helper</span><span class="p">,</span> <span class="n">get_learning_rate_scheduler</span>
</pre></div>
</div>
</li>
<li><p>The JSON configuration file is specified, which defines the model
architecture.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set config file</span>
<span class="n">json_file</span> <span class="o">=</span> <span class="s2">&quot;dlrm_fp32_64k.json&quot;</span>
</pre></div>
</div>
<p>The JSON file defines the input layers as follows:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">slot_size_array</span></code> is the cardinality of categorical input
features</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">source</span></code> is a text file that contains filenames for training</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">eval_source</span></code> is a text file that contains filenames for
evaluation</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">label</span></code>-<code class="docutils literal notranslate"><span class="pre">label_dim</span></code> provides the number of target columns</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dense</span></code>-<code class="docutils literal notranslate"><span class="pre">label_dim</span></code> provides the number of continuous input
features</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">sparse</span></code>-<code class="docutils literal notranslate"><span class="pre">label_dim</span></code> provides the number of categorical input
features</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Part of JSON config</span>
<span class="s2">&quot;layers&quot;</span><span class="p">:</span> <span class="p">[</span>
  <span class="p">{</span>
  <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span>
  <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;Data&quot;</span><span class="p">,</span>
  <span class="s2">&quot;format&quot;</span><span class="p">:</span> <span class="s2">&quot;Parquet&quot;</span><span class="p">,</span>
  <span class="s2">&quot;slot_size_array&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">10000000</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">,</span> <span class="mi">3014529</span><span class="p">,</span> <span class="mi">400781</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">2209</span><span class="p">,</span> <span class="mi">11869</span><span class="p">,</span> <span class="mi">148</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">977</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">38713</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">,</span> <span class="mi">584616</span><span class="p">,</span> <span class="mi">12883</span><span class="p">,</span> <span class="mi">109</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">17177</span><span class="p">,</span> <span class="mi">7425</span><span class="p">,</span>             <span class="mi">20266</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">7085</span><span class="p">,</span> <span class="mi">1535</span><span class="p">,</span> <span class="mi">64</span><span class="p">],</span>
  <span class="s2">&quot;source&quot;</span><span class="p">:</span> <span class="s2">&quot;/raid/criteo/tests/test_dask/output/train/_file_list.txt&quot;</span><span class="p">,</span>
  <span class="s2">&quot;eval_source&quot;</span><span class="p">:</span> <span class="s2">&quot;/raid/criteo/tests/test_dask/output/valid/_file_list.txt&quot;</span><span class="p">,</span>
  <span class="s2">&quot;check&quot;</span><span class="p">:</span> <span class="s2">&quot;None&quot;</span><span class="p">,</span>
  <span class="s2">&quot;label&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="s2">&quot;label&quot;</span><span class="p">,</span>
      <span class="s2">&quot;label_dim&quot;</span><span class="p">:</span> <span class="mi">1</span>
  <span class="p">},</span>
  <span class="s2">&quot;dense&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="s2">&quot;dense&quot;</span><span class="p">,</span>
      <span class="s2">&quot;dense_dim&quot;</span><span class="p">:</span> <span class="mi">13</span>
  <span class="p">},</span>
  <span class="s2">&quot;sparse&quot;</span><span class="p">:</span> <span class="p">[</span>
      <span class="p">{</span>
      <span class="s2">&quot;top&quot;</span><span class="p">:</span> <span class="s2">&quot;data1&quot;</span><span class="p">,</span>
      <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;LocalizedSlot&quot;</span><span class="p">,</span>
      <span class="s2">&quot;max_feature_num_per_sample&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span>
      <span class="s2">&quot;max_nnz&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
      <span class="s2">&quot;slot_num&quot;</span><span class="p">:</span> <span class="mi">26</span>
      <span class="p">}</span>
  <span class="p">]</span>
<span class="p">},</span>
</pre></div>
</div>
</li>
<li><p>The solver configuration is defined. The batch_sizes for training,
validation, and GPUs are specified in the solver
configuration.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set solver config</span>
<span class="n">solver_config</span> <span class="o">=</span> <span class="n">solver_parser_helper</span><span class="p">(</span><span class="n">seed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                                     <span class="n">batchsize</span> <span class="o">=</span> <span class="mi">16384</span><span class="p">,</span>
                                     <span class="n">batchsize_eval</span> <span class="o">=</span> <span class="mi">16384</span><span class="p">,</span>
                                     <span class="n">vvgpu</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">]],</span>
                                     <span class="n">repeat_dataset</span> <span class="o">=</span> <span class="kc">True</span>

<span class="p">)</span>
</pre></div>
</div>
</li>
<li><p>The learning rate schedule in the JSON file and HugeCTR session is
initialized.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Set learning rate</span>
<span class="n">lr_sch</span> <span class="o">=</span> <span class="n">get_learning_rate_scheduler</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
<span class="c1"># Train model</span>
<span class="n">sess</span> <span class="o">=</span> <span class="n">Session</span><span class="p">(</span><span class="n">solver_config</span><span class="p">,</span> <span class="n">json_file</span><span class="p">)</span>
<span class="n">sess</span><span class="o">.</span><span class="n">start_data_reading</span><span class="p">()</span>
</pre></div>
</div>
</li>
<li><p>The dataset is iterated for 5000 steps and the model is trained.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5000</span><span class="p">):</span>
   <span class="n">lr</span> <span class="o">=</span> <span class="n">lr_sch</span><span class="o">.</span><span class="n">get_next</span><span class="p">()</span>
   <span class="n">sess</span><span class="o">.</span><span class="n">set_learning_rate</span><span class="p">(</span><span class="n">lr</span><span class="p">)</span>
   <span class="n">sess</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
     <span class="n">loss</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">get_current_loss</span><span class="p">()</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[HUGECTR][INFO] iter: </span><span class="si">{}</span><span class="s2">; loss: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">loss</span><span class="p">))</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">%</span><span class="mi">3000</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">i</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
     <span class="n">metrics</span> <span class="o">=</span> <span class="n">sess</span><span class="o">.</span><span class="n">evaluation</span><span class="p">()</span>
     <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[HUGECTR][INFO] iter: </span><span class="si">{}</span><span class="s2">, </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">metrics</span><span class="p">))</span>
</pre></div>
</div>
</li>
</ol>
<p>Additional examples can be found <a class="reference external" href="https://github.com/NVIDIA/NVTabular/tree/main/examples/hugectr">here</a>.</p>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="pytorch.html" class="btn btn-neutral float-left" title="Accelerated Training with PyTorch" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../examples/index.html" class="btn btn-neutral float-right" title="NVTabular Example Notebooks" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, NVIDIA.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  
<div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    <span class="fa fa-book"> Other Versions</span>
    v: v0.10.0
    <span class="fa fa-caret-down"></span>
  </span>
  <div class="rst-other-versions">
    <dl>
      <dt>Tags</dt>
      <dd><a href="hugectr.html">v0.10.0</a></dd>
      <dd><a href="../../v0.11.0/training/hugectr.html">v0.11.0</a></dd>
      <dd><a href="../../v0.9.0/training/hugectr.html">v0.9.0</a></dd>
      <dd><a href="../../v1.0.0/training/hugectr.html">v1.0.0</a></dd>
      <dd><a href="../../v1.1.0/training/hugectr.html">v1.1.0</a></dd>
      <dd><a href="../../v1.1.1/training/hugectr.html">v1.1.1</a></dd>
    </dl>
    <dl>
      <dt>Branches</dt>
      <dd><a href="../../main/training/hugectr.html">main</a></dd>
    </dl>
  </div>
</div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>